## Item 17. 변경 가능성을 최소화하라
## 1. 불변 클래스란?
`final`이 붙은 필드 값이 한번 할당되면 더이상 변하지 않는 것처럼, 클래스에도 **인스턴스의 내부 값을 수정할 수 없는 클래스인 `불변 클래스`라는 것이 있다.** <br>

`final`이 붙은 필드와 같이 불변 인스턴스에 간직된 정보는 고정되며, 객체가 파괴되는 순간까지 바뀌지 않는다. <br>
**불변 클래스는 가변 클래스보다 설계하고 구현하고 사용하기 쉬우며, 오류가 생길 여지도 적고 훨씬 안전하다!** <br>
장점들이 참 많다~ Java에서도 기본적으로 다양한 불변 클래스를 제공한다. ex) `String`, `BigInteger`, `BigDecimal` 등..

## 2. 클래스 불변의 법칙
클래스를 불변으로 만들기 위해 따라야 할 **5가지 규칙을 살펴보자.** <br>

1. **객체의 상태를 변경하는 메서드를 제공하지 않는다.** 즉, **변경자 setter를 제공하지 않는다.**
2. **클래스를 확장할 수 없도록 한다.** <br> 하위 클래스에서 객체의 상태를 변하게 만드는 것을 막는다. `final class`로 선언하여도 되고, 다른 방식으로 상속을 막아도 된다.
3. **모든 필드를 final로 선언한다.** 이는 새로 생성된 인스턴스를 동기화 없이 다른 스레드로 건네도 문제없이 동작하게끔 보장하는 데도 필요하다.
4. **모든 필드를 private으로 선언한다.** <br> 필드가 참조하고 있는 가변 객체를 클라이언트에서 직접 수정하는 일을 막는다. <br> 사실 이런 처리 없이도, `public final`로 선언해도 불변 객체가 되지만, 이렇게 해두면 다음 릴리스에서 내부 표현을 바꾸지 못하므로 권하지 않는다.
5. **자신 외에는 내부 가변 컴포넌트에 접근할 수 없게 한다.**

위의 5가지 규칙을 지킴으로써, 불변 클래스를 만들 수 있다. <br>


### 2.1 자신을 상속하지 못하게 만드는 방법
불변 클래스를 만드는 방법 2번에 따르면, `final class`의 선언으로 간편하게 확장을 막을 수 있다. <br>

1. 모든 상속자를 private로 막아두고, public 정적 팩터리를 제공하는 방법 -> 이 방식이 최선일 때가 많다. public 생성자가 없으므로, 다른 패키지에서는 이 클래스를 확장하는 것이 불가능하고, 유연하며, 캐싱 적용이 쉽다.


## 3. 불변 객체 불변성
### 3.1 스레드 안전
불변 객체는 근본적으로 스레드 안전하여 따로 동기화할 필요가 없다. <br>
여러 스레드가 사용해도 훼손되지 않고, 클래스를 스레드 안전하게 만드는 가장 쉬운 방법이기도 하다. <Br>
불변 객체는 어떤 스레드도 다른 스레드에게 영향을 줄 수 없기 때문에, **안심하고 공유할 수 있다.** <Br>

### 3.2 인스턴스 공유와 캐싱
불변 객체는 스레드 안전하므로, **한번 만든 인스턴스를 최대한 재활용하기를 권한다.** <br>
자주 쓰이는 값들을 상수로 (public static final) 제공하거나, 인스턴스를 캐싱하여 같은 인스턴스를 중복 생성하지 않도록 정적 팩터리를 제공할 수 있다. <br>

그리고, 아무리 복사해도 원본과 같으므로 복사가 의미 없기 때문에, 방어적인 복사가 필요 없다. <Br>


### 3.3 불변 객체는 그 자체로 실패 원자성을 제공한다.
불변 객체의 메서드는 내부 상태를 바꾸지 않으므로, 메서드의 예외가 발생한 후에도 그 객체는 여전히 유효하다. <br>
**상태가 절대 변하지 않으니, 잠깐이라도 불일치 상태에 빠질 가능성이 없다.**

## 4. 불변 객체를 Map과 Set에 활용하라 
객체를 만들 때 다른 불변 객체들을 구성요소로 사용하면 이점이 많다. <br>
값이 바뀌지 않는 구성요소들로 이뤄진 객체라면 구조가 아무리 복잡해도 불변식을 유지하기가 훨씬 수월하다. <Br>
예를 들어 불변 객체를 Map의 Key와 Set의 원소로 사용하기에 좋다. 맵이나 집합은 안에 담긴 값이 바뀌면 불변식이 허물어지는데, 불변 객체를 사용함으로써 그런 일이 없어지기 때문이다.

## 5. 불변 클래스 단점
1. **값이 다르면 반드시 독립된 객체로 만들어야 한다:** 조금 바뀌는 데에도 새로운 인스턴스를 만들어 줘야하기 때문에, 공간적으로 비효율적이라고 할 수 있다. 만드는 시간도 있기 때문에, 시간적으로도 비효율적이다.


## 6. 정리
1. getter가 있다고 setter를 만들지 말자. <br>
2. **클래스는 꼭 필요한 경우가 아니면 불변이여야 한다.** 특히 단순한 값 객체는 불변으로 만들어 버려야 한다. <br>
3. 불변 클래스는 특정 상황에서의 잠재적 성능 저하만이 우려될 뿐, 다양한 장점이 있다! <br>

4. 모든 클래스를 불변으로 만들 수는 없다. 그래도 **불변으로 만들 수 없는 클래스의 변경할 수 있는 부분을 최소한으로 줄여야 한다. <br> `불변을 지향하자는 것`이다!**
5. 그러니 꼭 변경해야 할 필드를 뺀 나머지 모두를 final로 선언하자! <br>

6. 다른 합당한 이유가 없다면 모든 필드는 `private final`이어야 한다! <br>
7. 생성자는 **불변식 설정이 모두 완료된 상태의 객체를 생성해야 한다.**

## Reference
- Effective Java <조슈아 블로크>



