# Item 32. 제네릭과 가변인수를 함께 쓸 때는 신중하라
가변인수 메서드를 제네릭과 함께 쓸 때는 **메서드 작성자가 메서드의 타입 안전을 보장해야 한다.** <br>
가변인수 메서드는 호출시 가변인수들을 담기 위한 배열을 자동으로 만든다. <Br> 
이런 구현방식에는 문제가 있는데, 가변인수 배열이 클라이언트에게 노출되고 만다. <br> 
덕분에 **가변 매개변수에 제네릭이나 매개변수화 타입이 포함된다면,** 프로그래머에게 생성이 허용되지 않는 제네릭 배열이 만들어지게 되고, <br>
heap pollution과 관련된 알기 어려운 여러 컴파일 오류들을 만나게 될 수 있다. <br>
이런 허용은 실무에서의 유용함 때문에 수용되었다.. <Br>
위험한 행위를 유용함을 위해 수용해준 만큼, 조심해서 잘 쓸 필요가 있다! <br>

## 32.1 `@SafeVarargs`
**`@SafeVarargs` 애너테이션은 제네릭 메서드 작성자가 그 메서드 타입 안전을 보장하는 장치이다!** <br>
컴파일러는 그저 프로그래머의 약속을 믿고, 메서드에 대한 경고를 더 이상 하지 않는다! <br>
그런 만큼 프로그래머는 각별히 신경 써서 '안전한' 메서드에만 애너테이션을 붙여 주어야 한다. <br>


## 32.2 메서드의 타입 안전을 확신하는 방법
크게 보면, **매개변수 배열이 순수하게 인수의 전달로만 쓰이면 메서드는 안전하다.** <br>
구체적으로
1. 메서드는 **매개변수 배열에 아무것도 저장하지 않는다.** <Br> 즉, 덮어쓰지 않는다.
2. 메서드는 **매개변수 배열의 참조를 노출시키지 않는다.**

그리고 한가지 더 신경 써야 할 부분이 있는데,
3. **varargs 배열을 신뢰할 수 없는 코드에 노출시키지 말아라1** <br> **힙 오염 전이를 조심해라**


## 32.3 힙 오염 전이
힙 오염은 주로 매개변수화 타입의 변수가 타입이 다른 객체를 참조할 때 발생한다. <br>
```java
static <T> T[] toArray(T... args) {
  return args;
}
```
이 메서드가 반환하는 배열의 타입은, **메서드에 인수를 넘기는 컴파일 타임에 발생한다.** <br>
컴파일 타임에는 **컴파일러에게 충분한 정보가 주어지지 않아 타입을 잘못 판단하여 힙 오염이 발생할 수 있다.** <Br>
그런데 배열을 그대로 반환하면서 힙 오염을 메서드를 호출한 쪽의 콜스택까지 전이해 버리게 된다. <br>

그럼 이 `toArray()`를 포함한 제네릭 매개변수 메서드는 예상 못한 런타임 에러를 만들어 버릴 수도 있다.. <br>
**프로그래머는 이런 안전하지 못한 메서드의 접근을 허용해선 안 된다!** <br>
그래서 `@SafeVarargs` 어노테이션이 있는 것이다. <Br>
가변 매개변수를 인수로 갖는 제네릭 메서드는 반환값과 관련된 제네릭 메서드를 사용할 때 `@SafeVarargs` 어노테이션이 붙은 메서드만 사용해야 한다. <br>
그러니까 항상 기본적으로 안전한 varargs 메서드를 작성해야하고, <br>  
`@SafeVarargs`를 달아주고! `@SafeVarargs`달린 친구들과만 놀아야 한다! <br>
아니면 반환 타입에 공변인 배열 대신 List를 적극 활용하라 (아이템 28)
## Reference
- Effective Java <조슈아 블로크>
